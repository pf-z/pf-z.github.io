<!DOCTYPE html><html  data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>pfzh&#x27;s Log</title>
<script type="text/javascript" id="MathJax-script" async defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>@font-face{font-family:gara;font-style:normal;font-weight:400;src:url(/_nuxt/EBGaramond-Regular.BwvKMsqn.ttf) format("woff2")}@font-face{font-family:kaiti;font-style:normal;font-weight:400;src:url(/_nuxt/kaiti_GB2312.DzIJAoVO.ttf) format("woff2")}</style>
<style>code[class*=language-],pre[class*=language-]{background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-break:normal;word-spacing:normal;word-wrap:normal;-webkit-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style>
<style>h1[data-v-e9b7276b]{display:block;margin-left:0}.pub-date[data-v-e9b7276b]{font-size:1.2rem;line-height:150%}.content[data-v-e9b7276b]{color:#565959;font-size:1.25rem;line-height:150%}.origin[data-v-e9b7276b]{background-color:grey;border-radius:.25rem;color:#fff;display:inline-block;font-size:.9rem;margin-bottom:.25rem;margin-left:.5rem;padding:.1rem .25rem;vertical-align:middle}h1[data-v-e9b7276b]{font-size:2rem}h2[data-v-e9b7276b]{font-size:1.75rem}h3[data-v-e9b7276b]{font-size:1.5rem}h4[data-v-e9b7276b]{font-size:1.25rem}h5[data-v-e9b7276b]{font-size:1rem}h6[data-v-e9b7276b]{font-size:.875rem}code[data-v-e9b7276b],pre[data-v-e9b7276b]{background-color:#f6f8fa;border-radius:3px;font-family:Courier New,Courier,monospace;padding:.2rem .4rem}pre[data-v-e9b7276b]{white-space:pre-wrap;word-wrap:break-word}blockquote[data-v-e9b7276b]{border-left:5px solid grey;color:#6a737d;margin:1rem 0;padding-left:1em}ol[data-v-e9b7276b],ul[data-v-e9b7276b]{margin-bottom:1rem;margin-top:0;padding-left:1.2rem}ol[data-v-e9b7276b]{list-style-type:decimal}ul[data-v-e9b7276b]{list-style-type:square}li[data-v-e9b7276b]{margin-bottom:.5rem}a[data-v-e9b7276b]{color:#0366d6;text-decoration:none}a[data-v-e9b7276b]:hover{text-decoration:underline}hr[data-v-e9b7276b]{border:none;border-top:1px solid #e1e4e8;margin:1.25rem 0}code[data-v-e9b7276b]:not([class]){background-color:#f5f5f6;border-radius:3px;color:#9654b5;font-family:Courier New,monospace;font-size:1rem;font-weight:700;margin:0 3px;padding:1px 3px}img[data-v-e9b7276b]{display:block;margin:0 auto;width:80%}</style>
<style>html{font-size:16px}body{font-family:gara,kaiti,Serif}.dashed{border-bottom:1px dashed #83827f;margin:1.5rem 0}.header{justify-content:space-between}.header,.header-left{align-items:center;display:flex;flex-direction:row}.header-left{cursor:pointer}h1{font-size:2.15rem;font-weight:600;margin-left:.6rem}.intro{color:#5a5959;font-size:1.25rem;line-height:150%;margin:0}.social-icons{align-items:center;display:flex;flex-direction:row}.social-icons a,.social-icons a:hover{border-bottom:0}.icon{height:1.5rem;margin:0 .2rem;width:1.5rem}.ul{font-size:1.25rem;list-style-type:square;margin-left:-20px}.ul .li{line-height:150%;margin:10px 0}.ul .li,a{color:#565959}a{text-decoration:none}a,a:hover{border-bottom:1px dotted #000}a:hover{color:#4a6ff0;padding-bottom:1px}.qrcode{display:block;margin:0 auto;width:20%}@media (max-width:768px){.qrcode{width:30%}}.container{margin:0 auto;padding:1rem}@media (max-width:768px){.container{width:calc(100% - 2rem)}}@media (min-width:769px){.container{width:calc(770px - 2rem)}}</style>
<link rel="stylesheet" href="/_nuxt/entry.dC5WfgAD.css" crossorigin>
<link rel="stylesheet" href="/_nuxt/author.CAV4rWUv.css" crossorigin>
<link rel="preload" as="fetch" crossorigin="anonymous" href="/posts/JVM-runtime-data-area/_payload.json?5ca70794-98b3-4aac-9bca-9a5978e03bc8">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DC3hXE7m.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CdDau_0r.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/crruqxqu.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/C56Lechs.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/BWlaRgxM.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DjPtpOeJ.js">
<link rel="icon" type="image/png" href="/helio.png">
<script>MathJax = {tex: {inlineMath: [['$', '$'],['$$', '$$']]}};</script>
<script type="module" src="/_nuxt/DC3hXE7m.js" crossorigin></script>
<script id="unhead:payload" type="application/json">{"title":"pfzh's Log"}</script></head><body><div id="__nuxt"><!--[--><div class="container" data-v-e9b7276b><div class="header" data-v-e9b7276b><div class="header-left" data-v-e9b7276b><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200" data-v-e9b7276b><path d="M932.039565 483.875452 163.745365 483.875452l350.590843-311.627437c11.008728-9.784854 12.000312-26.6428 2.215458-37.651528-9.7869-11.005658-26.63973-11.999288-37.652552-2.214435L74.241888 492.064972c-5.693676 5.062296-8.950859 12.31549-8.950859 19.934005s3.257184 14.871709 8.950859 19.934005l404.65825 359.684966c5.080715 4.51585 11.405771 6.735401 17.708314 6.735401 7.352455 0 14.675234-3.022847 19.944238-8.950859 9.784854-11.008728 8.79327-27.865651-2.215458-37.652552L160.472831 537.214265l771.566734 0c14.729469 0 26.669406-11.94096 26.669406-26.669406C958.708971 495.815389 946.769035 483.875452 932.039565 483.875452z" fill="#272636" data-v-e9b7276b></path></svg><h1 style="margin-left:0.6rem;font-size:2.15rem;" data-v-e9b7276b>pf.zh</h1></div><div class="social-icons" data-v-e9b7276b><a href="https://orcid.org/0009-0008-1791-2942" target="_blank" data-v-e9b7276b><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200" data-v-e9b7276b><path d="M512 0C229.216 0 0 229.216 0 512s229.216 512 512 512 512-229.216 512-512S794.784 0 512 0zM314.4 186.784c22.4 0 40.416 18.4 40.416 40.416s-18.016 40.416-40.416 40.416a40.544 40.544 0 0 1-40.416-40.384c0-22.4 18.016-40.416 40.416-40.416z m-30.784 129.632h61.6v428.416H283.616z m151.968 0h166.4c158.368 0 228 113.184 228 214.4 0 109.984-86.016 214.4-227.2 214.4h-167.2z m61.6 55.584v317.6H595.2c139.616 0 171.616-105.984 171.616-158.816 0-86.016-54.784-158.816-174.816-158.816z" fill="#A6CE39" data-v-e9b7276b></path></svg></a><a href="/qrcode.jpg" target="_blank" data-v-e9b7276b><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200" data-v-e9b7276b><path d="M118.438 395.821c2.369-6.149 33.678 183.946 178.428 278.972l-15.978 88.06c40.236 1.303 78.704-16.536 103.663-48.072l-0.086-0.086c84.842 23.606 196.817 17.2 343.246-47.298 0 0-43.24 143.184-125.283 194.781-152.07 95.37-391.61 50.738-483.258-107.495-26.056-44.976-68.305-170.702-0.732-358.862z m624.476-100.788c148.088 53.771 229.99 212.072 188.204 363.764-14.73 49.792-44.489 149.376-227.525 229.61-9.82 4.386 293.331-368.45-161.674-588.472a367.37 367.37 0 0 1 200.995-4.902z m49.484-62.69c6.89 8.34-416.676-105.991-518.918 322.485v-0.215l-0.1-0.113c-3.226-3.672-83.855-96.422-80.479-191.444C211.493 203.351 345.881 82.208 506.905 80c52.068 0 156.248 0 285.493 152.342z" fill="#1FC372" data-v-e9b7276b></path></svg></a><a href="https://github.com/pf-z" target="_blank" data-v-e9b7276b><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200" data-v-e9b7276b><path d="M682.215454 981.446137c-25.532318 0-42.553863-17.021545-42.553864-42.553864v-165.960067c4.255386-34.043091-8.510773-59.575409-29.787704-80.852341-12.766159-12.766159-17.021545-29.787704-8.510773-42.553864 4.255386-17.021545 21.276932-25.532318 34.043091-29.787704 123.406204-12.766159 238.301635-55.320023 238.301635-255.323181 0-46.80925-17.021545-93.6185-51.064636-131.916976-12.766159-12.766159-12.766159-29.787704-8.510772-42.553864 12.766159-34.043091 12.766159-68.086182 4.255386-102.129272-21.276932 4.255386-55.320023 17.021545-110.640045 55.320022-8.510773 8.510773-21.276932 8.510773-34.043091 4.255387-89.363113-25.532318-187.236999-25.532318-276.600112 0-12.766159 4.255386-25.532318 4.255386-38.298477-4.255387C307.741455 104.836549 269.442978 92.07039 248.166047 87.815004c-8.510773 34.043091-8.510773 68.086182 4.255386 102.129272 4.255386 17.021545 4.255386 34.043091-8.510773 42.553864-34.043091 38.298477-51.064636 85.107727-51.064636 131.916976 0 200.003158 114.895431 242.557022 238.301635 255.323181 17.021545 0 29.787704 12.766159 34.043091 29.787704 4.255386 17.021545 0 34.043091-8.510773 42.553864-21.276932 21.276932-29.787704 46.80925-29.787704 76.596954v165.960068c0 25.532318-17.021545 42.553863-42.553863 42.553863s-42.553863-17.021545-42.553864-42.553863v-72.341568c-127.66159 21.276932-182.981613-51.064636-221.28009-97.873886-17.021545-21.276932-29.787704-38.298477-46.80925-42.553864-21.276932-4.255386-38.298477-29.787704-29.787704-51.064636 4.255386-21.276932 29.787704-38.298477 51.064636-29.787704 42.553863 12.766159 68.086182 42.553863 93.6185 72.341568 34.043091 46.80925 63.830795 80.852341 153.193908 63.830795v-4.255386c0-25.532318 4.255386-55.320023 12.766159-76.596955-119.150818-25.532318-246.812408-102.129272-246.812408-327.664748 0-63.830795 21.276932-123.406204 59.575409-170.215454-17.021545-59.575409-12.766159-114.895431 12.766159-170.215454 4.255386-12.766159 12.766159-21.276932 25.532318-25.532318 17.021545-4.255386 72.341568-12.766159 187.236999 59.575409 93.6185-21.276932 191.492386-21.276932 280.855499 0 110.640045-72.341568 170.215454-63.830795 187.236999-59.575409 12.766159 4.255386 21.276932 12.766159 25.532319 25.532318 21.276932 55.320023 25.532318 110.640045 12.766159 165.960067 38.298477 46.80925 59.575409 106.384659 59.575408 170.215454 0 242.557022-144.683136 306.387817-246.812408 331.920135 8.510773 25.532318 12.766159 55.320023 12.766159 80.852341V938.892273c0 25.532318-17.021545 42.553863-42.553863 42.553864z" fill="#2c2c2c" data-v-e9b7276b></path></svg></a><a href="https://leetcode.cn/u/feilyzhang/" target="_blank" data-v-e9b7276b><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200" data-v-e9b7276b><path d="M1023.522548 511.96634c0 163.697987 0 327.395973 0.477452 491.093959 0 17.051874-3.887827 20.939701-20.939701 20.871494q-491.09396-0.81849-982.187919 0c-17.051874 0-20.939701-3.81962-20.871493-20.871494q0.81849-491.09396 0-982.187919C-0.067321 3.820506 3.820506-0.067321 20.87238 0.000887q491.09396 0.81849 982.187919 0c17.051874 0 21.007908 3.81962 20.939701 20.871493-0.477452 163.697987-0.477452 327.395973-0.477452 491.09396z" fill="#FEFEFE" data-v-e9b7276b></path><path d="M454.876667 321.735638c-61.386745 61.386745-124.819715 121.068303-184.774103 184.160235-44.403079 46.722134-40.924497 113.906516 5.593015 161.924591 55.179863 56.680428 111.996706 111.723876 168.063266 167.449399 21.212531 21.962813 20.939701 47.063171 5.388392 70.390134-14.391781 21.485361-35.058652 34.649407-63.091932 22.576681a132.663577 132.663577 0 0 1-35.67252-25.577811c-51.769488-52.315148-104.766711-103.470769-155.990539-156.399784-89.897478-92.8304-90.92059-232.451141-0.477453-324.667673C320.985355 291.72434 449.965727 163.903496 578.400439 35.536991c28.30611-28.30611 63.842215-30.147713 87.032763-6.002259s21.007908 55.657315-6.411504 84.509085q-43.175344 45.426191-86.691726 90.443138c-30.693372 47.608831-71.822492 84.645501-117.453305 117.248683z" fill="#070706" data-v-e9b7276b></path><path d="M677.028476 641.014919H493.413901c-40.924497 0-70.185512-24.75932-69.503437-58.112785 0.613867-32.262145 27.965073-55.998353 68.207495-56.134768q187.02495-0.886697 374.049899 0c39.833177 0 62.34165 22.031021 62.682687 56.475805 0 35.740727-23.054133 57.294295-64.933534 57.70354-62.137027 0.54566-124.546885 0.068207-186.888535 0.068208z" fill="#B4B2B1" data-v-e9b7276b></path><path d="M386.055305 928.100263c60.568255-7.366409 79.052486-37.241292 57.70354-92.966815 63.842215 33.48988 110.837178 26.055263 162.470252-25.57781 26.464508-26.464508 52.519771-53.338261 79.598146-79.188901s57.43071-26.464508 81.439748-2.7283 23.531586 54.565996-1.978017 81.439748c-34.103747 35.195067-67.457212 70.594757-103.470769 103.266147-76.938054 69.776267-199.916166 75.914941-275.7629 15.755931z" fill="#EAA240" data-v-e9b7276b></path><path d="M454.876667 321.735638a1295.942393 1295.942393 0 0 1 117.453305-117.248683c89.692855 27.828658 142.349041 101.151714 202.371636 164.925721 19.575551 20.871493 11.663482 53.747506-10.776784 72.777397a53.338261 53.338261 0 0 1-73.868717-2.18264 821.627477 821.627477 0 0 1-74.414376-74.277961c-44.130249-52.315148-96.854642-66.502307-160.765064-43.993834z" fill="#EAA340" data-v-e9b7276b></path></svg></a><a href="https://x.com/FeilyZhang" target="_blank" data-v-e9b7276b><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200" data-v-e9b7276b><path d="M918.784 901.568L609.536 450.752l0.512 0.384L888.96 128h-93.184L568.576 391.04 388.224 128H143.808l288.704 420.928L128 901.568h93.184l252.544-292.608 200.704 292.608h244.352zM351.36 198.4l433.92 632.96h-73.856L277.12 198.272h74.176z" fill="#2c2c2c" fill-opacity="1" data-v-e9b7276b></path></svg></a></div></div><h1 data-v-e9b7276b>JVM runtime data area<span class="origin" data-v-e9b7276b>原创 / original</span></h1><p class="pub-date" data-v-e9b7276b>发表于 「2019 年 04 月 23 日」</p><div class="dashed" data-v-e9b7276b></div><div class="content" data-v-e9b7276b><p>Java虚拟机在执行Java程序过程中会把它所管理的内存划分为若干个不同的数据区域，这些区域各有用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有些区域则是依赖用户线程的启动和结束而建立和销毁。Jva虚拟机所管理的内存区域将会包括以下几个运行时数据区域：</p>
<p><img src="https://pfzh.me/pic/images/jvm-runtime.jpg" alt=""></p>
<h3>程序计数器</h3>
<p>程序计数器（Program Counter Register）是一小块内存空间，它的作用可以看作**当前线程所执行字节码的行号指示器。**在虚拟机的概念模型里，字节码解释器工作时就是通过改变这个计数器值来选取下一条需要执行的字节码指令，分支、循环、跳转和异常处理、线程恢复等基础功能也都是依赖这个计数器完成的，即改变计数器的行号，从而实现特定的功能。</p>
<p>由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器(或者多核处理器的一个核心)只会执行一条线程中的字节码指令。因此，为了多线程情况下每个线程都能在运行时恢复到正确的执行位置，各条线程都需要一个独立的程序计数器，各个线程之间的程序计数器互不影响，独立存储。即<strong>程序计数器是线程私有的内存。</strong></p>
<p>如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；如果正在执行的是native方法，这个计数器值则为空(Undefined)。此内存区域也是唯一一个在Java虚拟机规范中没有规定任何<code>OutOfMemoryError</code>情况的区域。</p>
<h3>Java虚拟机栈</h3>
<p>与程序计数器一样，Java虚拟机栈（Java Virtual Machine Stacks）也是线程私有的。在<a href="https://doc.feily.tech/class-file-structure.html">《Class文件结构》</a>中已经接触过了，它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：每个方法被执行的时候都会同时创建一个栈帧（Stack Frame）用于存储局部变量表、操作数栈、动态链接、方法出口等信息。<strong>每个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程，而一个栈帧(方法)内部的字节码指令的操作也是基于栈的(操作数栈).</strong></p>
<p>局部变量表中存放了编译期可知的各种基本数据类型（boolean、byte、char、short、int、float、long、double）、对象引用（reference类型，它不等于对象本身，根据不同的虚拟机实现，它可能是一个指向对象起始地址的引用指针，也可能指向一个代表对象的句柄或者其他与此对象相关的位置，也就是对对象访问的两种主流方式：<strong>使用句柄和直接指针</strong>）和returnAddress类型（指向了一条字节码指令的地址）。</p>
<p>其中64位长度的double和long类型的数据将会占用2个局部变量空间(Slot)，其余的数据类型只占用1个。局部变量表所需的内存空间在编译期间完成分配(Class文件结构中，方法表集合中的属性表集合中的Code属性中就有栈深度和变量表大小，这在编译期间就会确定下来，当调用一个方法，虚拟机栈就会读取相应的数据从而创建对应大小的操作数栈和局部变量表)，当进入一个方法时，这个方法需要在帧中分配多大的局部变量空间完全是确定的，在方法运行期间不会改变局部变量表的大小。</p>
<p>该区域存在两种异常状况：如果线程请求的栈深度大于虚拟机所允许的深度，将抛出<code>StackOverflowError</code>异常；如果虚拟机可以动态拓展，当拓展无法申请到足够的内存时会抛出<code>OutOfMemoryError</code>异常。</p>
<h3>本地方法栈</h3>
<p>本地方法栈（Native Method Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别不过是虚拟机栈为虚拟机执行Java方法(即字节码)服务，而本地方法栈则是为虚拟机使用到的Native方法服务。本地方法栈也会抛出<code>StackOverflowError</code>和<code>OutOfMemoryError</code>异常。</p>
<h3>Java堆</h3>
<p>对于大多数应用来说，Java堆（Java Heap）是Java虚拟机所管理的内存中最大的一块。Java堆是被所有线程共享的一块内存区域（即多线程环境下，堆中的对象(句柄)可能会被多个线程持有），在虚拟机启动时创建。此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例都是在这里分配的。这一点在Java虚拟机规范中的描述是：所有的对象实例和数组都要在堆上分配。但是随着JIT编译器的发展与逃逸分析技术的成熟，所有的对象分配在堆上也渐渐变得不再那么绝对。</p>
<p>Java堆是垃圾收集器管理的主要区域，因此很多时候被称为“GC堆”（Garbage Collected Heap）。如果从内存回收的角度看，由于现在收集器基本都是采用的分代收集算法，所以Java堆还可以细分为：新生代和老年代；再细致一点的有Eden空间、From Survivor空间、To Survivor空间等。如果从内存分配的角度看，线程共享的Java堆中可能划分出多个线程私有的分配缓冲区（Thread Local Allocation Buffer, TLAB）。<strong>不过，无论如何划分，都与存放内容无关，无论哪个区域，存储的仍然是对象实例，进一步划分的目的是更好更快的回收内存。</strong></p>
<p>根据Java虚拟机规范的规定，Java堆可以处于物理上不连续的内存空间中，只要逻辑上是连续的即可。在实现时，既可以实现成固定大小的，也可以是可拓展的，不过当前主流的虚拟机都是按照可拓展来实现的（通过<code>-Xmx</code>和<code>-Xms</code>控制）。如果堆中没有内存满足实例分配，并且堆也无法再拓展时，将会抛出OutOfMemoryError异常。</p>
<h3>方法区</h3>
<p>方法区（Method Area）与Java堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是它却又一个别名叫做Non-Heap（非堆），目的应该是与Java堆区分开来。</p>
<p>Java虚拟机对这个区域的限制非常宽松，除了和Java对一样不需要连续的内存和可以选择固定大小或者可拓展外，还可以选择不实现垃圾收集。相对而言，垃圾收集行为在这个区域是比较少见的。这个区域的内存回收目标主要是针对常量池的回收和对类型的卸载。</p>
<p>根据Java虚拟机规范的规定，当方法区无法满足内存分配需求时，将抛出<code>OutOfMemoryError</code>异常。</p>
<h3>运行时常量池</h3>
<p>运行时常量池（Runtime Constant Pool）是方法区的一部分。Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息就是常量池（Constant Pool Table），用于存放编译器生成的各种字面量和符号引用，这部分内容将在类加载后存放到方法区的运行时常量池中。</p>
<p>Java虚拟机对Class文件的每一部分的格式都有严格的规定，每一字节用于存储哪种数据都必须符合规范上的要求，这样才会被虚拟机认可、装载和执行。但对于运行时常量池，Java虚拟机规范没有做任何细节要求，不同的提供商实现的虚拟机可以按照自己的需要来实现这个内存区域</p>
<p>运行时常量池相对于Class文件常量池的另外一个重要特征是具备动态性。Java语言并不要求常量一定只能在编译期间产生，也就是并非预置入Class文件中的常量池的内容才能进入方法区运行时常量池，运行期间也可能将新的常量放入池中，这种特性被开发人员利用得比较多的便是String类的<code>intern()</code>方法。</p>
<p>由于运行时常量池是方法区的一部分，那么当常量池无法再申请到内存时会抛出<code>OutOfMemoryError</code>异常。</p>
<h3>直接内存</h3>
<p>直接内存（Direct Memory）并不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范中定义的内存区域，但是这部分内存也被频繁地使用，而且也有可能导致<code>OutOfMemoryError</code>异常出现。</p>
<p>在JDK1.4中新加入的NIO（New Input/Output）类，引入了一种基于通道（Channel）与缓冲区（Buffer）的I/O方式，它可以使用Native函数库直接分配堆外内存，然后通过一个存储在Java堆里面的DirectByteBuffer对象作为这块内存的引用来进行操作。这样能在一些场景中提高性能，因为避免了在Java堆和Native堆中来回复制数据(因为是通过指针来引用的)。</p>
<p>本机直接内存的分配不会受到Java堆大小的限制，但是会受到本机总内存（包括RAM及SWAP区或者分页文件）的大小及处理器寻址空间的限制。当该区域动态拓展时超过物理内存的限制时将会抛出<code>OutOfMemoryError</code>异常。</p>
</div><p style="text-align:center;color:#757575;" data-v-e9b7276b>Copyright © 2024 pfzh. All Rights Reserved.</p></div><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/posts/JVM-runtime-data-area/_payload.json?5ca70794-98b3-4aac-9bca-9a5978e03bc8">[{"state":1,"once":3,"_errors":4,"serverRendered":6,"path":7,"prerenderedAt":8},["Reactive",2],{},["Set"],["ShallowReactive",5],{},true,"/posts/JVM-runtime-data-area",1731849891062]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{},app:{baseURL:"/",buildId:"5ca70794-98b3-4aac-9bca-9a5978e03bc8",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>